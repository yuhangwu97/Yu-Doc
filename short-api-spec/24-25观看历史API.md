# 观看历史列表API集成文档

---

## 功能

**观看历史列表** - 获取用户的观看历史记录，支持分页查询。返回用户观看过的剧目信息，包括剧目名称、海报、观看进度、总播放量等。

---

## 接口说明

获取指定会员的观看历史列表，支持分页查询。接口会自动计算每个剧目的总播放量，并返回用户观看的剧集信息。

### 接口地址
```
GET /api/appApi/filmViewHistoryList
```

### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `memberId` | String | 是 | 会员ID |
| `pageNo` | Integer | 是 | 页码，从1开始 |
| `pageSize` | Integer | 是 | 每页数量 |

### 返回数据格式

```json
{
  "success": true,
  "message": "操作成功!",
  "code": 200,
  "result": {
    "records": [
      {
        "historyId": "观看历史ID",
        "collectId": "收藏ID",
        "memberId": "会员ID",
        "dramaId": "剧目ID",
        "dramaName": "剧目名称",
        "dramaPoster": "剧目海报URL",
        "seriesId": "剧集ID",
        "dramaSeries": 5,
        "totalPlay": "10.5万",
        "totalEpisodes": 30,
        "dramaDescribe": "剧目简介",
        "videoUrl": "视频地址"
      }
    ],
    "total": 50,
    "size": 20,
    "current": 1,
    "pages": 3
  },
  "timestamp": 1234567890
}
```

### 返回字段说明

#### 分页信息
| 字段名 | 类型 | 说明 |
|--------|------|------|
| `records` | Array | 观看历史列表数据 |
| `total` | Integer | 总记录数 |
| `size` | Integer | 每页数量 |
| `current` | Integer | 当前页码 |
| `pages` | Integer | 总页数 |

#### 观看历史记录字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| `historyId` | String | 观看历史ID |
| `collectId` | String | 收藏ID（如果该剧目已收藏） |
| `memberId` | String | 会员ID |
| `dramaId` | String | 剧目ID |
| `dramaName` | String | 剧目名称 |
| `dramaPoster` | String | 剧目海报URL |
| `seriesId` | String | 剧集ID（用户观看的剧集） |
| `dramaSeries` | Integer | 剧集集数（用户观看到第几集） |
| `totalPlay` | String | 总播放量（格式：超过1万显示"X.X万"，否则显示具体数字） |
| `totalEpisodes` | Integer | 剧目总集数 |
| `dramaDescribe` | Object | 剧目简介 |
| `videoUrl` | String | 视频地址 |

### 业务逻辑说明

1. **参数验证**：如果 `memberId` 为空，接口会返回错误提示
2. **数据查询**：根据会员ID查询观看历史记录，支持分页
3. **播放量计算**：自动计算每个剧目的总播放量（所有剧集播放量之和）
4. **数据格式化**：播放量超过1万时显示为"X.X万"格式，否则显示具体数字

### 常见错误信息

| 错误信息 | 说明 | 处理建议 |
|---------|------|---------|
| `请传入memberId(会员ID)` | memberId参数为空 | 检查请求参数，确保传入有效的memberId |

### 使用建议

1. **分页处理**：建议每页显示10-20条数据，根据实际UI设计调整
2. **加载更多**：可以实现上拉加载更多功能，递增 `pageNo` 参数
3. **空状态处理**：当 `records` 为空数组时，显示"暂无观看历史"提示
4. **播放进度显示**：使用 `dramaSeries` 和 `totalEpisodes` 字段显示观看进度（如"已观看 5/30 集"）
5. **跳转逻辑**：点击历史记录时，使用 `dramaId` 跳转到剧目详情页，使用 `seriesId` 定位到用户观看的剧集
6. **播放量显示**：直接使用 `totalPlay` 字段显示，已格式化处理

---

## 相关接口

- **删除观看历史**：`DELETE /api/appApi/deleteViewHistory`（删除指定会员的所有观看历史）

