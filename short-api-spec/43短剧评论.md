# 短剧评论系统前端对接详细文档

## 1. 基础信息

*   **Base URL**: `/app/appDramaComment`
*   **Authentication**: header `X-Access-Token: {token}` (部分查询接口可能不需要，但建议统一携带)

## 2. 接口详解

### 2.1 剧集评论区 (普通评论列表)

此接口负责渲染剧集下方的评论区域。为了提升性能和用户体验，采用**分层加载**的模式。
支持两种排序：`hot` (按点赞热度，默认), `new` (按最新时间)。

#### 场景 A: 获取【一级评论】列表 (Root Comments)
即直接发表在视频下的评论，没有父级。

*   **接口地址**: `/list`
*   **请求方式**: `GET`
*   **关键参数**:
    *   `filmDramaId`: 剧目ID (必填)
    *   `seriesId`: 建议传剧集ID，精准获取该集的评论。
    *   `orderBy`: 排序方式。传 `hot` (最热，默认) 或 `new` (最新)。
    *   **`rootId`**: **不传** 或 **传空字符串**。

**返回数据特点**:
*   `parentId`: "0"
*   `rootId`: "0"
*   **`replyCount`**: **重要**。该字段表示这条一级评论下面有多少条回复。
    *   如果 `replyCount > 0`，前端应显示 "查看 x 条回复" 按钮或类似交互。
    *   如果 `replyCount = 0`，则不显示展开按钮。

**响应示例 (Response)**:
```json
{
  "success": true,
  "message": "查询成功",
  "result": {
    "records": [
      {
        "id": "1001",
        "filmDramaId": "drama_001",
        "seriesId": "series_01",
        "content": "这部剧的演员演技都在线！",
        "userId": "user_123",
        "userName": "追剧达人",
        "userAvatar": "https://example.com/avatar1.png",
        "userEmail": "xx@example.com",
        "createTime": "2024-01-25 10:00:00",
        "likeCount": 200,                // 点赞数
        "replyCount": 3,                 // 重点：表示下面有3条回复
        "parentId": "0",
        "rootId": "0",
        "replyUserName": null
      },
      {
        "id": "1002",
        "content": "一般般吧",
        "userId": "user_456",
        "userName": "路人甲",
        "replyCount": 0,                 // 0表示没有回复
        "rootId": "0"
        // ...
      }
    ],
    "total": 50,
    "size": 10,
    "current": 1
  }
}
```

#### 场景 B: 获取【二级评论/回复】列表 (Reply Comments)
即点击 "查看回复" 后，获取某条一级评论下的所有对话详情。

*   **接口地址**: `/list`
*   **请求方式**: `GET`
*   **关键参数**:
    *   `filmDramaId`: 同上。
    *   **`rootId`**: **传入该条一级评论的 ID** (即场景A中获取到的 `id`，例如 "1001")。
    *   `orderBy`: 通常传 `new`（按时间顺序展示对话）。

**返回数据特点**:
*   `rootId`: 等于你传入的参数 ID。
*   `parentId`: 指向被回复的评论 ID。
*   `replyUserName`: 指向被回复的人的昵称。
    *   前端展示格式建议：`{userName} 回复 {replyUserName}: {content}`。

**响应示例 (Response)**:
```json
{
  "success": true,
  "message": "查询成功",
  "result": {
    "records": [
      {
        "id": "sub_2001",
        "rootId": "1001",               // 属于 ID=1001 的楼层
        "parentId": "1001",             // 直接回复层主
        "content": "确实，尤其是男主",
        "userId": "user_789",
        "userName": "张三",
        "replyUserId": "user_123",      // 被回复人 ID (层主)
        "replyUserName": "追剧达人"      // 被回复人昵称 → 展示 "张三 回复 追剧达人"
      },
      {
        "id": "sub_2002",
        "rootId": "1001",
        "parentId": "sub_2001",         // 回复楼里的另一个人
        "content": "同感！",
        "userId": "user_999",
        "userName": "李四",
        "replyUserName": "张三"          // → 展示 "李四 回复 张三"
      }
    ]
  }
}
```

---

### 2.2 视频弹幕列表

用于在视频播放器上方滚动的弹幕。
**评估建议**: 弹幕通常只适合展示短小精悍的**一级评论**。因此后端强制过滤，**只返回一级评论**。

*   **接口地址**: `/danmu`
*   **请求方式**: `GET`
*   **参数**:
    *   `filmDramaId`: 必填。
    *   `seriesId`: 必填 (弹幕是跟随单集的)。
*   **排序**: 强制按 `likeCount` 倒序 (最热弹幕优先展示)。

**响应示例 (Response)**:
```json
{
  "success": true,
  "result": {
    "records": [
      {
        "id": "5555",
        "content": "高能预警！！！",      // 弹幕内容
        "userId": "user_888",
        "userName": "弹幕护体",
        "likeCount": 9999,              // 热度最高，排在前面
        "rootId": "0"
      },
      {
        "id": "6666",
        "content": "哈哈哈哈笑死我了",
        "likeCount": 5000
      }
    ]
  }
}
```

---

### 2.3 发表评论/回复

*   **接口地址**: `/add`
*   **请求方式**: `POST`

**场景 A: 发表一级评论**
```json
{
  "filmDramaId": "xx",
  "seriesId": "xx",
  "content": "剧情不错！",
  "parentId": ""  // 或不传
}
```

**场景 B: 回复某条评论 (盖楼)**
```json
{
  "filmDramaId": "xx",
  "seriesId": "xx",
  "content": "确实如此",
  "parentId": "123456" // 被回复的那条评论ID (无论是一级还是二级，都传当前点击的那条)
}
```
*注意*: 后端会自动计算 `rootId`。

---

### 2.4 点赞

*   **接口地址**: `/like`
*   **请求方式**: `POST`
*   **参数**: `id` (评论ID)

---

## 3. 字段字典 (Entity)

| 字段 | 说明 | 前端逻辑 |
| :--- | :--- | :--- |
| `id` | 评论ID | 唯一标识 |
| `userId` | 用于跳转主页 | |
| `userName` | 评论者昵称 | 直接显示 |
| `userAvatar` | 评论者头像 | 直接显示 |
| `userEmail` | 评论者邮箱 | 可选显示 |
| `replyUserName` | 被回复者昵称 | 仅二级评论有值，用于 "回复 XX" |
| `content` | 内容 | 文本内容 |
| `createTime` | 时间 | 格式 yyyy-MM-dd HH:mm:ss |
| `likeCount` | 点赞数 | 显示热度 |
| `replyCount` | **子评论数** | **仅一级评论有效**。大于0显示“展开回复” |
